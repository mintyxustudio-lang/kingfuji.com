<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>金富士智能排座系统 · iOS/WeChat 版</title>
<style>
  :root { --bg1:#f6d67a; --bg2:#fbeec2; --text:#222; --overlaybg:rgba(0,0,0,0.72); }
  html,body { margin:0; padding:0; width:100%; height:100%; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif; background:#f5f7fb; }
  .splash { position:fixed; inset:0; background:linear-gradient(to bottom,var(--bg1),var(--bg2)); display:flex; flex-direction:column; align-items:center; justify-content:center; color:var(--text); text-align:center; z-index:1; }
  @keyframes breath { 0%{transform:scale(1);} 50%{transform:scale(1.05);} 100%{transform:scale(1);} }
  h1 { font-size:28px; margin:12px 16px 6px; font-weight:700; color:var(--text); animation:breath 3s infinite ease-in-out; }
  h2 { font-size:16px; margin:4px 16px 14px; font-weight:500; color:#333; }
  .loader { border:4px solid #ddd; border-top:4px solid var(--text); border-radius:50%; width:38px; height:38px; animation:spin 1.1s linear infinite; margin:8px auto; }
  @keyframes spin { 0%{transform:rotate(0deg);} 100%{transform:rotate(360deg);} }
  .loading-text { font-size:13px; color:var(--text); margin-top:6px; }
  .copyright { font-size:11px; color:#333; position:absolute; bottom:14px; left:0; right:0; text-align:center; line-height:1.5; padding:0 12px; box-sizing:border-box; }
  .fade-out { opacity:0; transition:opacity 0.9s ease-out; }
  .wx-overlay { position:fixed; inset:0; background:var(--overlaybg); color:#fff; z-index:2; display:none; }
  .wx-card { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); width:min(92vw,520px); background:#111; border-radius:14px; padding:16px 16px 12px; box-shadow:0 8px 40px rgba(0,0,0,0.45); }
  .wx-title { font-size:18px; font-weight:700; margin:0 0 8px; }
  .wx-tip { font-size:14px; line-height:1.6; opacity:.95; }
  .wx-steps { margin:10px 0 0; font-size:13px; line-height:1.8; }
  .wx-actions { margin-top:12px; display:flex; gap:10px; flex-wrap:wrap; }
  .btn { -webkit-appearance:none; appearance:none; border:0; border-radius:10px; padding:10px 14px; font-size:14px; font-weight:600; cursor:pointer; }
  .btn-primary { background:#ffd45c; color:#222; }
  .btn-ghost { background:#222; color:#fff; border:1px solid #444; }
  .hint-arrow { position:absolute; top:10px; right:18px; color:#fff; font-size:12px; opacity:.9; }
  .err { display:none; position:absolute; bottom:70px; left:0; right:0; font-size:13px; color:#b00020; text-align:center; }
</style>
</head>
<body>
  <div class="splash" id="splash">
    <h1>金富士智能排座系统</h1>
    <h2>Kane Fuji Smart Seating Manager</h2>
    <div class="loader"></div>
    <div class="loading-text">正在加载系统，请稍候…<br/>Loading system, please wait…</div>
    <div class="err" id="err">未找到主系统文件。请将本文件与 <b>KaneFuji_Seating_v1_Integrated.html</b> 放在同一文件夹后重新打开。</div>
    <div class="copyright">
      © 2025 WenBin. All rights reserved.<br>
      All designs, interface layouts, and system logic are the intellectual property of WenBin.<br>
      © 2025 WenBin. 版权所有。<br>
      本系统的所有设计、界面及逻辑均由 WenBin 独立开发并享有知识产权。
    </div>
  </div>

  <div class="wx-overlay" id="wxOverlay" role="dialog" aria-modal="true" aria-labelledby="wxTitle">
    <div class="hint-arrow">点右上角「⋯」</div>
    <div class="wx-card">
      <div class="wx-title" id="wxTitle">请在 Safari 中打开</div>
      <div class="wx-tip">检测到你在微信内打开。为保证完整功能（导游导入、排座、平面图等），请按以下步骤在 Safari 打开：</div>
      <div class="wx-steps">
        ① 点击右上角「⋯」<br/>
        ② 选择「在 Safari 中打开」<br/>
        ③ 打开后可“添加到主屏幕”，下次像 App 一样使用
      </div>
      <div class="wx-actions">
        <button class="btn btn-primary" id="btnCopyLink">复制链接</button>
        <button class="btn btn-ghost" id="btnClose">我知道了</button>
      </div>
    </div>
  </div>

<script>
(function() {{
  var ua = navigator.userAgent || navigator.vendor || window.opera || "";
  var isWeChat = /MicroMessenger/i.test(ua);
  var splash = document.getElementById('splash');
  var overlay = document.getElementById('wxOverlay');
  var err = document.getElementById('err');

  function fadeOutSplash() {{
    splash.classList.add('fade-out');
    setTimeout(function(){{ splash.style.display='none'; }}, 900);
  }}

  if (isWeChat) {{
    overlay.style.display = 'block';
    // 保留背景3秒后淡出，不影响提示可读性
    setTimeout(fadeOutSplash, 3000);
  }} else {{
    // Safari / 其他浏览器：尝试跳转到主系统文件（需与本文件在同一文件夹）
    var targets = [
      'KaneFuji_Seating_v1_Integrated.html',
      'jinfushi_seating_20x30_auto_import_final_protected.html',
      'jinfushi_seating_20x30_auto_import_final.html'
    ];
    var idx = 0;
    function tryNext() {{
      if (idx >= targets.length) {{
        err.style.display = 'block';
        return fadeOutSplash();
      }}
      var url = targets[idx++];
      // 直接导航（本地 file:// 下 fetch 可能受限，用直接跳转）
      window.location.href = url;
      // 兜底：如果2秒后还在当前页，继续尝试下一个
      setTimeout(function() {{
        if (!document.hidden && (document.visibilityState !== 'hidden')) {{
          tryNext();
        }}
      }}, 2000);
    }}
    setTimeout(tryNext, 800);
  }}

  // 复制链接
  var btnCopy = document.getElementById('btnCopyLink');
  btnCopy.addEventListener('click', function() {{
    var url = window.location.href;
    if (navigator.clipboard && navigator.clipboard.writeText) {{
      navigator.clipboard.writeText(url).then(function() {{
        btnCopy.textContent = '已复制，去 Safari 粘贴';
        setTimeout(function(){{ btnCopy.textContent='复制链接'; }}, 1800);
      }}).catch(function(){{ prompt('复制失败，请手动全选复制：', url); }});
    }} else {{
      prompt('复制链接到剪贴板：', url);
    }}
  }});

  document.getElementById('btnClose').addEventListener('click', function() {{
    overlay.style.display='none';
  }});
}})();
</script>
</body>
</html>
